## NetWork

![[Pasted image 20240419112657.png]]


## 网络连接
### way1
用于容器之间通信
`--link <名称ID>: 容器别名`

```c
1.
docker run -dit --name apl1 alpine ash
2.
docker run -dit --name alp2 --link apl1:alp alpine ash 
```

![[Pasted image 20240419142203.png]]
### way2
自定义桥接网络并连接容器
```c
docker network create [选项] 网络名称
```

--driver(-d)选项指定网络驱动，默认为 bridge，即桥接网络;

--gateway选项指定子网的网关;

--ip-range 选项指定子网中容器的IP 地址范围。

要将容器连接到自定义网络，可以在使用 docker run 命令启动容器时，使用`--network` 选项连接到指定的自定义网络。
如 :
```c
docker run -d nginx --name ng --network test
```
其中test为已经存在的网络

对于正在运行的容器而言，可以使用`docker network connect` 命令将它连接到指定的网络。

## 端口

#### 使用-P 选项发布所有暴露的端口

通过 docker run 命令创建容器时，使用-P 选项将容器中所有暴露的端口发布到 Docker 主机上随机的高端地址端口中。
这要求容器中要发布的端口必须提前暴露出来，有两种方式可以暴露端口:一种是在 Dockerfile 中使用 EXPOSE 指令定义,另一种是执行 docker run 命令创建容器时使用--expose选项指定。

而使用-P 选项发布端口时,即使该端口没有使用 EXPOSE 指令或
--expose 选项显式声明Docker也会隐式暴露这些已经发布的端口。


## 数据卷挂载

#### -v选项的基本语法

`-v[主机中的源:]容器中的目标[:<选项>]`
该选项包括由冒号(:)分隔的3个字段。
这些字段必须按照正确的顺序排列。
第1个字段表示挂载源(来自主机的文件系统 )，第2个字段是挂载目标(容器中的挂载点，可以是目录或文件路径，必须采用绝对路径的形式 )，第 3个字段是可选的，是一个以逗号分隔的选项列表，如 ro 表示只读。



#### --mount选项的基本语法
`--mount<键>=<值>,<键>=<值>，`
该选项的参数由多个由逗号分隔的键值对组成。--mount 选项的语法比-v 选项更冗长，但键的排列顺序并不重要，并且键值更易于理解。其主要的键列举如下。
- type: 指定要挂载的类型,值可以是 bind( 绑定挂载)volume( 卷 )或 tmpfs。默认使用 volume.
- source(或 src ):指定挂载源。对于卷，这里是卷名;对于绑定挂载，则为主机上的目录或文件。
- destination(或 dst、target):指定挂载目标，即容器中的挂载点，必须采用绝对路径的形式。
- readonly:指定只读选项，表示源以只读方式挂载到容器中。其他键:可以被多次指定，由若干键值对组成。卷和绑定挂载有不同的键。

#### 匿名卷

```c
docker run -it --name ng --mount destination=/lingzj
centos:7 /bin/bash
或者
docker run -it --name ng -v /lingzj
centos:7 /bin/bash
```

--mount destination=/lingzj, 未指定数据源,默认为匿名卷;
删除匿名卷需要完全指定卷的UUID

![[Pasted image 20240420195806.png]]

#### 绑定挂载主机上的目录


```c
docker run -d  -it --name ng -v  "$(pwd)"/target:/lzj nginx
```

![[Pasted image 20240420143048.png]]

此处表明用宿主机的目录挂载到容器的目录中

这表明挂载方式是绑定挂载，源和目标都正确。与卷挂载不同的是，这里的挂载类型为 bind，源为主机上指定的目录，而不是 Docker 根目录中的特定路径。
传播(Propagation)方式是rprivate，表示是私有的。

#### 绑定挂载到容器中的非空目录
如果将主机上的目录绑定挂载到容器上的非空目录，则容器挂载的目录中的现有内容会被绑定挂载(主机上的目录)所遮盖。

被遮盖的目录和文件不会被删除或更改，但在使用绑定挂载时不可访问。
一般容易出现以下问题 :
- 挂载路径与容器内路径冲突：挂载到容器内已存在的路径可能会导致文件被`覆盖`或`隐藏`，这可能会干扰 `容器` 的正常启动。确保挂载路径不会与容器内已有的路径冲突。


#### 使用容器填充卷

- 如果容器启动时挂载已经存在并拥有包含数据的卷，则容器不会将其挂载点目录的数据复制到该卷，而是直接使用该卷中的数据。

- 如果容器启动时挂载空白卷(卷已存在但没有任何数据)或者自动创建新卷，而容器在挂载点目录中已有文件或目录，则该挂载点目录的内容会被传播(复制)到卷中，也就是将容器中挂载点目录的数据填充到卷中。其他容器挂载并使用该卷时可以访问其中预先填充的内容。











