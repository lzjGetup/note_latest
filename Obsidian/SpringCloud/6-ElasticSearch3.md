# 排序

>![[Pasted image 20240203141315.png]]

# 特定打分

>![[Pasted image 20240203142336.png]]

# 聚合

### Bucket
>![[Pasted image 20240204125340.png]]

Bucket聚合会统计文档数量count,一般默认为降序排序,若要改变,则在`"terms"`添加`"order":{"_count: "asc"}`

>![[Pasted image 20240204130219.png]]


### Metrics

>![[Pasted image 20240204130626.png]]

同理倘若需要对聚合结果进行排序,则可以在`"terms"`添加`"order":{"scoreAgg.avg: "desc"}`

## RestAPI

>![[Pasted image 20240204131733.png]]

>![[Pasted image 20240204132117.png]]


## 自定义分词器

>![[Pasted image 20240204142125.png]]


>![[Pasted image 20240204142413.png]]


>![[Pasted image 20240204143010.png]]


对于同音字,我们的策略是创建索引时用拼音分词器. 实际搜索时,采用IK分词器,如下例子:

>![[Pasted image 20240204143155.png]]


## 自动补全

>![[Pasted image 20240204143653.png]]


>![[Pasted image 20240204143830.png]]

## RestAPI

>![[Pasted image 20240204145203.png]]

>![[Pasted image 20240204145504.png]]


# MySQL_ES数据同步

>![[Pasted image 20240204151908.png]]

>![[Pasted image 20240204152014.png]]


## ES集群

### 节点

>![[Pasted image 20240204155342.png]]

#### 脑裂问题
主节点归属分歧

>![[Pasted image 20240204155921.png]]


#### 分布式存储

>![[Pasted image 20240204160401.png]]

==一旦创建索引库,分片数目不可修改==

#### 根据ID新增文档

>![[Pasted image 20240204160720.png]]

在Elasticsearch中，查询实际上包括了分散（Scatter）和聚集（Gather）两个阶段。

- 在分散阶段，协调节点会将查询请求发送到各个数据节点上，并让它们各自执行查询操作，这样可以并行地搜索匹配的文档。

- 在聚集阶段，各个数据节点会将查询结果返回给协调节点，协调节点会汇总这些结果，并进行排序、分页等操作，最终将最终的查询结果返回给用户。


#### 故障转移

Elasticsearch的故障转移具体步骤如下：

1. 检测故障：当一个节点出现故障时，其他节点会检测到这个故障，比如通过心跳检测等机制。
2. 标记未分配分片：集群会将受影响的分片标记为未分配状态，因为这些分片原本所在的节点不可用了。
3. 重新分配分片：集群会尝试将未分配的分片重新分配到其他健康的节点上，以保证数据的可用性和均衡分布。
4. 数据恢复：一旦分片被重新分配到新的节点上，Elasticsearch会自动进行数据恢复，确保新节点上的分片数据与原来的一致。











